[transforms.aws_cloudwatch_logs_subscription_parser]
title = "AWS CloudWatch Logs Subscription Parser"
allow_you_to_description = "parse AWS CloudWatch Logs subscription events"
beta = true
common = false
function_category = "parse"
input_types = ["log"]
output_types = ["log"]
requirements = {}

<%= render("_partials/fields/_component_options.toml", type: "transform", name: "aws_cloudwatch_logs_subscription_parser") %>

[[transforms.aws_cloudwatch_logs_subscription_parser.examples]]
label = "Default"
body = """\
The `aws_cloudwatch_logs_subscription_parser` will emit one event for every \
parsed log event.

For eample, given this incoming event:

```json
{
  "messageType": "DATA_MESSAGE",
  "owner": "111111111111",
  "logGroup": "test",
  "logStream": "test",
  "subscriptionFilters": [
    "Destination"
  ],
  "logEvents": [
    {
      "id": "35683658089614582423604394983260738922885519999578275840",
      "timestamp": 1600110569039,
      "message": "{\\"bytes\\":26780,\\"datetime\\":\\"14/Sep/2020:11:45:41 -0400\\",\\"host\\":\\"157.130.216.193\\",\\"method\\":\\"PUT\\",\\"protocol\\":\\"HTTP/1.0\\",\\"referer\\":\\"https://www.principalcross-platform.io/markets/ubiquitous\\",\\"request\\":\\"/expedite/convergence\\",\\"source_type\\":\\"stdin\\",\\"status\\":301,\\"user-identifier\\":\\"-\\"}"
    },
    {
      "id": "35683658089659183914001456229543810359430816722590236673",
      "timestamp": 1600110569041,
      "message": "{\\"bytes\\":17707,\\"datetime\\":\\"14/Sep/2020:11:45:41 -0400\\",\\"host\\":\\"109.81.244.252\\",\\"method\\":\\"GET\\",\\"protocol\\":\\"HTTP/2.0\\",\\"referer\\":\\"http://www.investormission-critical.io/24/7/vortals\\",\\"request\\":\\"/scale/functionalities/optimize\\",\\"source_type\\":\\"stdin\\",\\"status\\":502,\\"user-identifier\\":\\"feeney1708\\"}"
    }
  ]
}
```

The following events will be generated:

```json
{
  "id": "35683658089614582423604394983260738922885519999578275840",
  "log_group": "test",
  "log_stream": "test",
  "message": "{\\"bytes\\":26780,\\"datetime\\":\\"14/Sep/2020:11:45:41 -0400\\",\\"host\\":\\"157.130.216.193\\",\\"method\\":\\"PUT\\",\\"protocol\\":\\"HTTP/1.0\\",\\"referer\\":\\"https://www.principalcross-platform.io/markets/ubiquitous\\",\\"request\\":\\"/expedite/convergence\\",\\"source_type\\":\\"stdin\\",\\"status\\":301,\\"user-identifier\\":\\"-\\"}",
  "owner": "111111111111",
  "timestamp": "2020-09-14T19:09:29.039Z"
}
{
  "id": "35683658089659183914001456229543810359430816722590236673",
  "log_group": "test",
  "log_stream": "test",
  "message": "{\\"bytes\\":17707,\\"datetime\\":\\"14/Sep/2020:11:45:41 -0400\\",\\"host\\":\\"109.81.244.252\\",\\"method\\":\\"GET\\",\\"protocol\\":\\"HTTP/2.0\\",\\"referer\\":\\"http://www.investormission-critical.io/24/7/vortals\\",\\"request\\":\\"/scale/functionalities/optimize\\",\\"source_type\\":\\"stdin\\",\\"status\\":502,\\"user-identifier\\":\\"feeney1708\\"}",
  "owner": "111111111111",
  "timestamp": "2020-09-14T19:09:29.041Z"
}
```

Note that the events themselves are not parsed. If they are structured data, you \
will typically want to pass them through a [parsing \
transform][urls.vector_parsing_transforms]. \
```
"""

[transforms.aws_cloudwatch_logs_subscription_parser.fields.log.fields.id]
type = "string"
examples = ["35683658089614582423604394983260738922885519999578275840"]
description = "The event id."

[transforms.aws_cloudwatch_logs_subscription_parser.fields.log.fields.message]
type = "string"
examples = ["hello", "{\"key\": \"value\"}"]
description = "The body of the log event."

[transforms.aws_cloudwatch_logs_subscription_parser.fields.log.fields.timestamp]
type = "string"
examples = ["2020-09-14T19:09:29.041Z"]
description = "The timestamp of the log event."

[transforms.aws_cloudwatch_logs_subscription_parser.fields.log.fields.log_group]
type = "string"
examples = ["/lambda/test"]
description = "The log group the event came from."

[transforms.aws_cloudwatch_logs_subscription_parser.fields.log.fields.log_stream]
type = "string"
examples = ["2020/03/24/[$LATEST]794dbaf40a7846c4984ad80ebf110544"]
description = "The log stream the event came from."

[transforms.aws_cloudwatch_logs_subscription_parser.fields.log.fields.owner]
type = "string"
examples = ["111111111111"]
description = "The ID of the AWS account the logs came from."
